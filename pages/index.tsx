import Head from 'next/head'
import { Inter } from 'next/font/google'
import { useEffect, useRef, useState } from 'react';
import Image from 'next/image';
import { Box, Flex, Input, InputGroup, InputLeftElement, Link, Spacer, Text, VStack } from '@chakra-ui/react'
import { SearchIcon } from '@chakra-ui/icons';
import Hero from '@/components/hero';

const inter = Inter({ subsets: ['latin'] })

export default function Home() {
  const ref = useRef<null | HTMLDivElement>(null);
  const [results, setResults] = useState([]);
  const [searchValue, setSearchValue] = useState('')

  const handleClick = () => {
    ref.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    handleChange()
  }, [searchValue])



  const handleChange = async () => {
    const response = await fetch(`http://34.255.11.66/voting/results?search=${searchValue}`);
    const pdfResults = await response.json();

    setResults(pdfResults)

  }

  return (
    <>
      <Head>
        <title>Grassroots Elections</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <Hero handleClick={handleClick} />

        <Box
          height="100vh"
          ref={ref}
          // justifyContent='center'
          // alignItems='center'
          p={{base: '40px 5px 0px 5px', lg: '40px 140px 0px 140px'}}
        >
          <Flex >
            <InputGroup borderRadius='12px' w={400}>
              <InputLeftElement pointerEvents='none'>
                <SearchIcon color='gray.300' />
              </InputLeftElement>
              <Input
                bgColor='#F5F7F8'
                placeholder='Search by Polling Center'
                value={searchValue}
                onChange={(e) => setSearchValue(e.target.value)}
              />
            </InputGroup>
          </Flex>
          <Box>

            {results.map((result: any, index) => (
              <Flex
                alignItems='center'
                my={4}
                borderTop='1px solid #EDEDED'
                borderBottom='1px solid #EDEDED'
                py={19}
                key={index}
              >
                <Flex >
                  <Image src="/pdf-icon.svg" alt="Vercel Logo" width={57} height={16} />
                  <VStack alignItems='left' ml={2}>
                    <Text fontWeight={700} fontSize={24}>{result.polling_center_name}</Text>
                    <Text color='#B4B4B4' fontSize={16}>{result.polling_center_code}</Text>
                  </VStack>


                </Flex>
                <Spacer />
                <Link
                  border='1px solid #1A932E'
                  borderRadius={100}
                  color='#1A932E'
                  fontSize={20}
                  fontWeight={700}
                  bgColor='white'
                  p='11px 21px'
                  href={result.report_page_link}
                  isExternal
                >
                  View Results
                </Link>
              </Flex>
            ))}



          </Box>

        </Box>

      </main>
    </>
  )
}
